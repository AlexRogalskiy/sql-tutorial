<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<script src="https://kit.fontawesome.com/4eee35f757.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="stylesheet" href="../github.css" type="text/css">
<link rel="stylesheet" href="../tutorial.css" type="text/css">
<script defer data-domain="gvwilson.github.io/sql-tutorial" src="https://plausible.io/js/script.js"></script>
<title>The Querynomicon &middot; PostgreSQL</title>

  </head>
  <body>
    <nav>
  <div class="row underline">
    <div class="col-2 left">
      <a class="navlink" href="../">Home</a>
    </div>
    <div class="col-10 right">
      
      <a class="navlink" href="../python/">Python</a>
      
      <a class="navlink" href="../postgresql/">PostgreSQL</a>
      
      |
      <a class="navlink" href="https://github.com/gvwilson/sql-tutorial">repo</a>
      <a href="https://github.com/gvwilson/sql-tutorial/raw/main/sql-tutorial.zip">download</a>
      <a class="navlink" href="../license/">license</a>
      <a class="navlink" href="../conduct/">conduct</a>
      <a class="navlink" href="../contributing/">contributing</a>
      <a class="navlink" href="../colophon/">colophon</a>
    </div>
  </div>
</nav>

    <main>
      
  <h1>PostgreSQL</h1>


      <!-- ---------------------------------------------------------------- -->
<section class="topic">
<h2 class="topic">1: Why PostgreSQL?</h2>
<ul>
<li>This is a valid question, especially if you are already familiar with other databases like SQLite
    that are simpler to set up,
    run locally,
    and do not follow the <a href="#what-is-the-client-server-model-after-all">client-server model</a>.</li>
<li>The answer is that the client-server model that PostgreSQL follows offers robustness,
    scalability,
    and effectiveness in handling large volumes of data.</li>
<li>Furthermore, it provides enhanced concurrency with features like multi-line transactions.
    The above are necessary for modern, complex, real-world applications,
    and non-client-server databases like SQLite cannot guarantee them.</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">2: The Client-Server Model</h2>
<ul>
<li>A <a href="#g:local_db">local (non-client-server) database</a>
    is designed to run on a single computer or device,
    storing data locally and accessed by applications on the same machine.</li>
<li>This setup is ideal for standalone applications where simplicity and ease of deployment are priorities.</li>
<li>On the other hand, a <a href="#g:client_server_db">client-server database</a>
    operates on a networked environment where the database server runs independently of client applications.</li>
<li>Clients connect to the server over a network to query, update, and manage data.<ul>
<li>Of course the server and the client can live on the same machine.</li>
<li>Mainly done for educational purposes (like this tutorial).</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">3: Setup on MacOS: Direct Installer</h2>
<ul>
<li>
<p>Quick and simple setup.</p>
</li>
<li>
<p>Download the <a href="https://www.enterprisedb.com/downloads/postgres-postgresql-downloads">latest version of PostgreSQL for macOS</a>.</p>
</li>
<li>Double-click the downloaded file to run the installer<ol>
<li>Click &ldquo;Next&rdquo;.
    You might see a warning message because it was downloaded from the internet.
    If so, click &ldquo;Open&rdquo; to continue.</li>
<li>Leave the default installation folder and click &ldquo;Next&rdquo;.</li>
<li>Leave the default components and click &ldquo;Next&rdquo;.</li>
<li>Leave the default location (the database files will be stored there). </li>
<li>You will be prompted to create a password; make sure to remember it. Click &ldquo;Next&rdquo;.</li>
<li>Leave the default options (port and locale) and click &ldquo;Next&rdquo;.</li>
<li>Click &ldquo;Next&rdquo;; if requested, provide your Mac OS password (the one you use for unlocking your laptop).</li>
<li>Click &ldquo;Finish&rdquo;.</li>
</ol>
</li>
<li>Open PgAdmin from the Applications folder.</li>
<li>In the top-left corner of PgAdmin, expand the &ldquo;Servers&rdquo; option by clicking on it.</li>
<li>Click &ldquo;PostgreSQL&rdquo;; if prompted, use the password you created in step 2.4.</li>
<li>You are now connected to PostgreSQL.</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">4: Setup on MacOS: With Options</h2>
<ol>
<li>Download <a href="https://postgresapp.com/downloads.html">the latest version of Postgress.app</a>.</li>
<li>Open the downloaded <code>.dmg</code> file.</li>
<li>Drag <code>Postgres</code> to the Applications folder.</li>
<li>Open the Applications folder, then open <code>Postgres</code>.
    The first time you open the app,
    you might see a warning message because it was downloaded from the internet.
    If so, click &ldquo;Open&rdquo; to continue.</li>
<li>Once the app is open, click &ldquo;Initialize&rdquo; to start your PostgreSQL session.</li>
<li>You can see the existing databases (they have been created by default).
    Double click one and the terminal for running queries to that database will open</li>
<li>
<p>You are now connected to PostgreSQL.</p>
</li>
<li>
<p>Optional and advanced - only if you wish to use the command line tools as well:</p>
</li>
<li>
<p>Open a terminal window.</p>
</li>
<li>Run <code>open ~/.zshrc</code> (or <code>~/.bashrc</code> depending on your shell).</li>
<li>Add the following line to the bottom of the file:
    <br>
    <code>export PATH=$PATH:/Applications/Postgres.app/Contents/Versions/latest/bin</code></li>
<li>Run <code>source ~/.zshrc</code>.</li>
<li>Verify installation by running <code>psql</code>.</li>
</ol>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">5: Running Queries Using PgAdmin</h2>
<ol>
<li>
<p>Open PgAdmin.</p>
</li>
<li>
<p>Right click &ldquo;Databases&rdquo; -&gt; &ldquo;Create&rdquo; -&gt; &ldquo;Database&rdquo;.
    Write &ldquo;penguins&rdquo; in the &ldquo;Database&rdquo; field and then click &ldquo;Save&rdquo;.</p>
</li>
<li>
<p>Right click to the &ldquo;penguins&rdquo; database from the menu in the left:
    a. Click &ldquo;Query tool&rdquo;.
    b. Click &ldquo;Open file&rdquo; in the top left of the Query tool.
    c. Select the file <code>db/penguins.sql</code>.
    d. Click &ldquo;Execute&rdquo;.</p>
</li>
<li>
<p>Expand &ldquo;penguins&rdquo; -&gt; &ldquo;Schemas&rdquo; -&gt; &ldquo;Tables&rdquo;.
    You should see two tables: <code>little_penguins</code> and <code>penguins</code>.</p>
</li>
<li>
<p>Right click <code>penguins</code> -&gt; &ldquo;Query tool&rdquo;.</p>
</li>
<li>
<p>Run the query .
    <div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>
    to see the first entries of the <code>penguins</code> table</p>
</li>
<li>
<p>Count penguins:
    <div class="highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="p">;</span>
</code></pre></div></p>
</li>
</ol>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">6: Running Queries in the Terminal</h2>
<ul>
<li>Run the command-line PostgreSQL client and tell it what database to use:</li>
</ul>
<div class="highlight"><pre><span></span><code>psql<span class="w"> </span>-d<span class="w"> </span>penguins<span class="w"> </span>
</code></pre></div>
<ul>
<li>Run the queries from the previous section</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">7: Privileges and Roles</h2>
<ul>
<li>PostgreSQL is commonly used for applications with a large user base.</li>
<li>For this reason, it has a <a href="#g:privileges">privilege managment system</a>
    to control who has what kind of access to what data.<ul>
<li>You may want the users of your application to be able to read the SQL records,
    but not update or delete them.</li>
<li>Or in an organization where many developers work on the same database,
    it may be desirable that some developer teams can only read existing or write new records,
but not modify or delete existing records.</li>
</ul>
</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">8: Creating a Role and Granting Privileges</h2>
<ul>
<li>A database <a href="#g:role">role</a> is similar to a user account<ul>
<li>Can own database objects</li>
<li>Can be granted permissions to access and manipulate data</li>
</ul>
</li>
<li>Roles can represent individual users, groups of users, or both.</li>
<li>
<p>Can be assigned a variety of privileges and access rights within the database</p>
</li>
<li>
<p>Create role in PgAdmin:</p>
<ol>
<li>In the Object Explorer panel,
    expand Servers -&gt; PostgreSQL -&gt; Right click Login/Group roles -&gt; Create -&gt; Login/Group role.</li>
<li>Enter &ldquo;penguin_reader_writer&rdquo; in the &ldquo;name&rdquo; field.</li>
<li>Go to the &ldquo;Privileges&rdquo; tab, and enable the &ldquo;Can Login?&rdquo; option.</li>
<li>Click &ldquo;Save&rdquo;.</li>
</ol>
</li>
<li>
<p>Grant permissions in PgAdmin:</p>
<ol>
<li>Right click the &ldquo;penguins&rdquo; table from Object Explorer.</li>
<li>Go to &ldquo;Properties&rdquo; -&gt; &ldquo;Security&rdquo; -&gt; Click the &ldquo;+&rdquo; button on the top-right.</li>
<li>Select &ldquo;penguin_reader_writer&rdquo; from the dropdown list.</li>
<li>In the &ldquo;Privileges&rdquo; column, check the &ldquo;SELECT&rdquo; and &ldquo;UPDATE&rdquo; options.</li>
<li>Click &ldquo;Save&rdquo;.</li>
</ol>
</li>
<li>
<p>Create role in the terminal:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">penguin_reader_writer</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">LOGIN</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;reader_writer&#39;</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>Grant permissions in the terminal:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="p">,</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="n">little_penguins</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">penguin_reader_writer</span><span class="p">;</span>
</code></pre></div>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">9: Verifying Privileges in PgAdmin</h2>
<ul>
<li>
<p>Connect as <code>penguin_reader_writer</code> to verify that this role can only select or update records:</p>
<ol>
<li>Right click &ldquo;Servers&rdquo; -&gt; &ldquo;Register&rdquo; -&gt; &ldquo;Server&rdquo; in the left panel.</li>
<li>In the &ldquo;name&rdquo; field enter &ldquo;Penguin Reader Writer&rdquo;.</li>
<li>Go to the &ldquo;Connection&rdquo; tab:
    a.  In the &ldquo;Host name/address&rdquo; field enter &ldquo;localhost&rdquo;.
    b.  In the &ldquo;Maintenance database&rdquo; field enter &ldquo;penguins&rdquo;.
    c.  In the &ldquo;Username&rdquo; field enter &ldquo;penguin_reader_writer&rdquo;.
    d.  In the &ldquo;Password&rdquo; field enter &ldquo;reader_writer&rdquo;.</li>
<li>Click &ldquo;Save&rdquo;.</li>
</ol>
</li>
<li>
<p>Close and reopen PgAdmin,
    but instead of &ldquo;PostgreSQL&rdquo;, select the &ldquo;Penguin Reader Writer&rdquo; as the user ID.</p>
</li>
<li>Run a simple query that <em>reads</em> data:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>
<p>It successfully returns 10 records from the table.</p>
</li>
<li>
<p>Now try to <em>change</em> data:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Antarctica&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MALE&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Torgersen&#39;</span><span class="p">;</span>
</code></pre></div>
<ul>
<li>
<p>That works too (updates 23 records).</p>
</li>
<li>
<p>But now try to <em>delete</em> data:</p>
</li>
</ul>
<p><div class="highlight"><pre><span></span><code><span class="k">DELETE</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">islant</span><span class="o">=</span><span class="s1">&#39;Antarctica&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">sex</span><span class="o">=</span><span class="s1">&#39;MALE&#39;</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ERROR:<span class="w"> </span>permission<span class="w"> </span>denied<span class="w"> </span><span class="k">for</span><span class="w"> </span>table<span class="w"> </span>penguins<span class="w"> </span>
</code></pre></div></p>
<ul>
<li>Because the <code>penguin_reader_writer</code> role does not have <code>DELETE</code> privileges</li>
</ul>
<!-- ---------------------------------------------------------------- -->
</section>
<section class="topic">
<h2 class="topic">10: Revoking Privileges</h2>
<ul>
<li>Tighten up access so that <code>penguin_reader_writer</code> does not have <code>UPDATE</code> privileges (only <code>SELECT</code>)</li>
<li>In PgAdmin:<ol>
<li>Right click on the &ldquo;penguins&rdquo; table in the Object Explorer panel.</li>
<li>Go to &ldquo;Properties&rdquo; -&gt; &ldquo;Security&rdquo; -&gt; Click the &ldquo;Privileges&rdquo; column of the <code>penguin_reader_writer</code> row.</li>
<li>Un-check the &ldquo;Update&rdquo; checkbox.</li>
<li>Click &ldquo;Save&rdquo;.</li>
</ol>
</li>
<li>
<p>In the terminal:
<div class="highlight"><pre><span></span><code><span class="k">REVOKE</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">penguins</span><span class="p">,</span><span class="w"> </span><span class="n">little_penguins</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">penguin_reader_writer</span><span class="p">;</span>
</code></pre></div></p>
</li>
<li>
<p>To verify:
<div class="highlight"><pre><span></span><code><span class="k">UPDATE</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Atlantis&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MALE&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">island</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Antarctica&#39;</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>ERROR:<span class="w"> </span>permission<span class="w"> </span>denied<span class="w"> </span><span class="k">for</span><span class="w"> </span>table<span class="w"> </span>penguins<span class="w"> </span>
</code></pre></div></p>
</li>
</ul>
</section>
    </main>
    <footer>
  <i class="fa fa-copyright"></i> 2024 Greg Wilson
  &middot;
  <a href="mailto:gvwilson@third-bit.com"><i class="fas fa-envelope-square" aria-hidden="true" title="author email"></i></a>
  <a href="https://github.com/gvwilson/sql-tutorial"><i class="fab fa-github" aria-hidden="true" title="GitHub repository"></i></a>
  <a href="../license/"><i class="fab fa-creative-commons-by" aria-hidden="true" title="license"></i></a>
  &middot;
  <i class="fas fa-clock"></i>
  <time datetime="2024-04-03">Last built 2024-04-03</time>
  &middot;
  <i class="fas fa-user-check"></i> 100% human content
</footer>

  </body>
</html>
