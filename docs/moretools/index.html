<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="../logo.svg">
<link rel="stylesheet" href="../mccole.css" type="text/css">
<title>The Querynomicon &middot; More Tools</title>
<script>
  MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']]
    }
  };
</script>
<script
  type="text/javascript"
  id="MathJax-script"
  async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>

  <script defer data-domain="gvwilson.github.io/sql-tutorial" src="https://plausible.io/js/plausible.js"></script>


  </head>
  <body>
    <main>
      <div class="row notex">
  <div class="col-1"></div>
  <div class="col-10 center">
    
      <h1>More Tools</h1>
    
  </div>
  <div class="col-1"></div>
</div>

      
<nav class="row notex">
  <div class="col-1 left">
    <a href="../toolbox/" class="undecorated" title="previous page">&#x25C5;</a>
  </div>
  <div class="col-10 center">
    <a href="../" title="home" class="undecorated">&#x25EC;</a>
  </div>
  <div class="col-1 right">
    <a href="../oddsends/" class="undecorated" title="next page">&#x25BB;</a>
  </div>
</nav>


      
      <p class="terms">Terms defined: 
<a class="gl-ref" href="../glossary/#gl:b_tree" markdown="1">B-tree</a>, <a class="gl-ref" href="../glossary/#gl:cte" markdown="1">common table expression</a>, <a class="gl-ref" href="../glossary/#gl:er_diagram" markdown="1">entity-relationship diagram</a>, <a class="gl-ref" href="../glossary/#gl:expression" markdown="1">expression</a>, <a class="gl-ref" href="../glossary/#gl:statement" markdown="1">statement</a>, <a class="gl-ref" href="../glossary/#gl:vectorization" markdown="1">vectorization</a>
</p>
      <h2>Comparing Individual Values to Aggregates</h2>
<ul>
<li>Go back to the original penguins database</li>
</ul>
<div class="language-sql" title="compare_individual_aggregate.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="n">body_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">where</span>
<span class="w">    </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span>
<span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="p">)</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="compare_individual_aggregate.out">
<div class="highlight"><pre><span></span><code>| body_mass_g |
|-------------|
| 4675.0      |
| 4250.0      |
| 4400.0      |
| 4500.0      |
| 4650.0      |
</code></pre></div>
</div>
<ul>
<li>Get average body mass in subquery</li>
<li>Compare each row against that</li>
<li>Requires two scans of the data, but no way to avoid that<ul>
<li>Except calculating a running total each time a penguin is added to the table</li>
</ul>
</li>
<li>Null values aren&rsquo;t included in the average or in the final results</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Use a subquery to find the number of penguins
that weigh the same as the lightest penguin.</p>
<h2>Comparing Individual Values to Aggregates Within Groups</h2>
<div class="language-sql" title="compare_within_groups.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">penguins</span><span class="p">.</span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">penguins</span><span class="p">.</span><span class="n">body_mass_g</span><span class="p">,</span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="n">averaged</span><span class="p">.</span><span class="n">avg_mass_g</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">species</span><span class="p">,</span>
<span class="w">        </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_mass_g</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span>
<span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">averaged</span>
<span class="w">    </span><span class="k">on</span><span class="w"> </span><span class="n">penguins</span><span class="p">.</span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">averaged</span><span class="p">.</span><span class="n">species</span>
<span class="k">where</span><span class="w"> </span><span class="n">penguins</span><span class="p">.</span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">averaged</span><span class="p">.</span><span class="n">avg_mass_g</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="compare_within_groups.out">
<div class="highlight"><pre><span></span><code>| species | body_mass_g | avg_mass_g |
|---------|-------------|------------|
| Adelie  | 3750.0      | 3700.7     |
| Adelie  | 3800.0      | 3700.7     |
| Adelie  | 4675.0      | 3700.7     |
| Adelie  | 4250.0      | 3700.7     |
| Adelie  | 3800.0      | 3700.7     |
</code></pre></div>
</div>
<ul>
<li>Subquery runs first to create temporary table <code>averaged</code> with average mass per species</li>
<li>Join that with <code>penguins</code></li>
<li>Filter to find penguins heavier than average within their species</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Use a subquery to find the number of penguins
that weigh the same as the lightest penguin of the same sex and species.</p>
<h2>Common Table Expressions</h2>
<div class="language-sql" title="common_table_expressions.sql">
<div class="highlight"><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="n">grouped</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">species</span><span class="p">,</span>
<span class="w">        </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_mass_g</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span>
<span class="p">)</span>

<span class="k">select</span>
<span class="w">    </span><span class="n">penguins</span><span class="p">.</span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">penguins</span><span class="p">.</span><span class="n">body_mass_g</span><span class="p">,</span>
<span class="w">    </span><span class="n">round</span><span class="p">(</span><span class="n">grouped</span><span class="p">.</span><span class="n">avg_mass_g</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_mass_g</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span><span class="w"> </span><span class="k">inner</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="n">grouped</span>
<span class="k">where</span><span class="w"> </span><span class="n">penguins</span><span class="p">.</span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">grouped</span><span class="p">.</span><span class="n">avg_mass_g</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="common_table_expressions.out">
<div class="highlight"><pre><span></span><code>| species | body_mass_g | avg_mass_g |
|---------|-------------|------------|
| Adelie  | 3750.0      | 3700.7     |
| Adelie  | 3800.0      | 3700.7     |
| Adelie  | 4675.0      | 3700.7     |
| Adelie  | 4250.0      | 3700.7     |
| Adelie  | 3800.0      | 3700.7     |
</code></pre></div>
</div>
<ul>
<li>Use <a class="gl-ref" href="../glossary/#gl:cte" markdown="1">common table expression</a> (CTE) to make queries clearer<ul>
<li>Nested subqueries quickly become difficult to understand</li>
</ul>
</li>
<li>Database decides how to optimize</li>
</ul>
<h2 class="aside">Explaining Query Plans</h2>
<div class="language-sql" title="explain_query_plan.sql">
<div class="highlight"><pre><span></span><code><span class="k">explain</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">plan</span>
<span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="k">avg</span><span class="p">(</span><span class="n">body_mass_g</span><span class="p">)</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="explain_query_plan.out">
<div class="highlight"><pre><span></span><code>QUERY PLAN
|--SCAN penguins
`--USE TEMP B-TREE FOR GROUP BY
</code></pre></div>
</div>
<ul>
<li>SQLite plans to scan every row of the table</li>
<li>It will build a temporary <a class="gl-ref" href="../glossary/#gl:b_tree" markdown="1">B-tree data structure</a> to group rows</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Use a CTE to find
the number of penguins
that weigh the same as the lightest penguin of the same sex and species.</p>
<h2>Enumerating Rows</h2>
<ul>
<li>Every table has a special column called <code>rowid</code></li>
</ul>
<div class="language-sql" title="rowid.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">rowid</span><span class="p">,</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="n">island</span>
<span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="k">limit</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="rowid.out">
<div class="highlight"><pre><span></span><code>| rowid | species |  island   |
|-------|---------|-----------|
| 1     | Adelie  | Torgersen |
| 2     | Adelie  | Torgersen |
| 3     | Adelie  | Torgersen |
| 4     | Adelie  | Torgersen |
| 5     | Adelie  | Torgersen |
</code></pre></div>
</div>
<ul>
<li><code>rowid</code> is persistent within a session<ul>
<li>I.e., if we delete the first 5 rows we now have row IDs 6…N</li>
</ul>
</li>
<li><em>Do not rely on row ID</em><ul>
<li>In particular, do not use it as a key</li>
</ul>
</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>To explore how row IDs behave:</p>
<ol>
<li>
<p>Suppose that you create a new table,
    add three rows,
    delete those rows,
    and add the same values again.
    Do you expect the row IDs of the final rows to be 1–3 or 4–6?</p>
</li>
<li>
<p>Using an in-memory database,
    perform the steps in part 1.
    Was the result what you expected?</p>
</li>
</ol>
<h2>Conditionals</h2>
<div class="language-sql" title="if_else.sql">
<div class="highlight"><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="n">sized_penguins</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">species</span><span class="p">,</span>
<span class="w">        </span><span class="n">iif</span><span class="p">(</span>
<span class="w">            </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3500</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;small&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="s1">&#39;large&#39;</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">size</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">)</span>

<span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="k">size</span><span class="p">,</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num</span>
<span class="k">from</span><span class="w"> </span><span class="n">sized_penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="k">size</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="if_else.out">
<div class="highlight"><pre><span></span><code>|  species  | size  | num |
|-----------|-------|-----|
| Adelie    | small | 54  |
| Adelie    | large | 97  |
| Chinstrap | small | 17  |
| Chinstrap | large | 51  |
| Gentoo    | large | 123 |
</code></pre></div>
</div>
<ul>
<li><code>iif(<em>condition</em>, <em>true_result</em>, <em>false_result</em>)</code><ul>
<li>Note: <code>iif</code> with two i&rsquo;s</li>
</ul>
</li>
<li>May feel odd to think of <code>if</code>/<code>else</code> as a function,
    but common in <a class="gl-ref" href="../glossary/#gl:vectorization" markdown="1">vectorized</a> calculations</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>How does the result of the previous query change
if the check for null body mass is removed?
Why is the result without that check misleading?</p>
<p>What does each of the expressions shown below produce?
Which ones do you think actually attempt to divide by zero?</p>
<ol>
<li><code>iif(0, 123, 1/0)</code></li>
<li><code>iif(1, 123, 1/0)</code></li>
<li><code>iif(0, 1/0, 123)</code></li>
<li><code>iif(1, 1/0, 123)</code></li>
</ol>
<h2>Selecting a Case</h2>
<ul>
<li>What if we want small, medium, and large?</li>
<li>Can nest <code>iif</code>, but quickly becomes unreadable</li>
</ul>
<div class="language-sql" title="case_when.sql">
<div class="highlight"><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="n">sized_penguins</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">species</span><span class="p">,</span>
<span class="w">        </span><span class="k">case</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3500</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;small&#39;</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;large&#39;</span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">size</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">)</span>

<span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="k">size</span><span class="p">,</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num</span>
<span class="k">from</span><span class="w"> </span><span class="n">sized_penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="k">size</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="case_when.out">
<div class="highlight"><pre><span></span><code>|  species  |  size  | num |
|-----------|--------|-----|
| Adelie    | small  | 54  |
| Adelie    | medium | 97  |
| Chinstrap | small  | 17  |
| Chinstrap | medium | 51  |
| Gentoo    | medium | 56  |
| Gentoo    | large  | 67  |
</code></pre></div>
</div>
<ul>
<li>Evaluate <code>when</code> options in order and take first</li>
<li>Result of <code>case</code> is null if no condition is true</li>
<li>Use <code>else</code> as fallback</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Modify the query above so that
the outputs are <code>"penguin is small"</code> and <code>"penguin is large"</code>
by concatenating the string <code>"penguin is "</code> to the entire <code>case</code>
rather than to the individual <code>when</code> branches.
(This exercise shows that <code>case</code>/<code>when</code> is an <a class="gl-ref" href="../glossary/#gl:expression" markdown="1">expression</a>
rather than a <a class="gl-ref" href="../glossary/#gl:statement" markdown="1">statement</a>.)</p>
<h2>Checking a Range</h2>
<div class="language-sql" title="check_range.sql">
<div class="highlight"><pre><span></span><code><span class="k">with</span><span class="w"> </span><span class="n">sized_penguins</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="k">select</span>
<span class="w">        </span><span class="n">species</span><span class="p">,</span>
<span class="w">        </span><span class="k">case</span>
<span class="w">            </span><span class="k">when</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="k">between</span><span class="w"> </span><span class="mi">3500</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">5000</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="s1">&#39;normal&#39;</span>
<span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;abnormal&#39;</span>
<span class="w">        </span><span class="k">end</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">size</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">penguins</span>
<span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">body_mass_g</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="p">)</span>

<span class="k">select</span>
<span class="w">    </span><span class="n">species</span><span class="p">,</span>
<span class="w">    </span><span class="k">size</span><span class="p">,</span>
<span class="w">    </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">num</span>
<span class="k">from</span><span class="w"> </span><span class="n">sized_penguins</span>
<span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="k">size</span>
<span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="check_range.out">
<div class="highlight"><pre><span></span><code>|  species  |   size   | num |
|-----------|----------|-----|
| Adelie    | abnormal | 54  |
| Adelie    | normal   | 97  |
| Chinstrap | abnormal | 17  |
| Chinstrap | normal   | 51  |
| Gentoo    | abnormal | 61  |
| Gentoo    | normal   | 62  |
</code></pre></div>
</div>
<ul>
<li><code>between</code> can make queries easier to read</li>
<li>But be careful of the <code>and</code> in the middle</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>The expression <code>val between 'A' and 'Z'</code> is true if <code>val</code> is <code>'M'</code> (upper case)
but false if <code>val</code> is <code>'m'</code> (lower case).
Rewrite the expression using <a href="https://www.sqlite.org/lang_corefunc.html">SQLite&rsquo;s built-in scalar functions</a>
so that it is true in both cases.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>substr</code></td>
<td>Get substring given starting point and length</td>
</tr>
<tr>
<td><code>trim</code></td>
<td>Remove characters from beginning and end of string</td>
</tr>
<tr>
<td><code>ltrim</code></td>
<td>Remove characters from beginning of string</td>
</tr>
<tr>
<td><code>rtrim</code></td>
<td>Remove characters from end of string</td>
</tr>
<tr>
<td><code>length</code></td>
<td>Length of string</td>
</tr>
<tr>
<td><code>replace</code></td>
<td>Replace occurrences of substring with another string</td>
</tr>
<tr>
<td><code>upper</code></td>
<td>Return upper-case version of string</td>
</tr>
<tr>
<td><code>lower</code></td>
<td>Return lower-case version of string</td>
</tr>
<tr>
<td><code>instr</code></td>
<td>Find location of first occurrence of substring (returns 0 if not found)</td>
</tr>
</tbody>
</table>
<h2 class="aside">Yet Another Database</h2>
<ul>
<li><a class="gl-ref" href="../glossary/#gl:er_diagram" markdown="1">Entity-relationship diagram</a> (ER diagram) shows relationships between tables</li>
<li>Like everything to do with databases, there are lots of variations</li>
</ul>
<figure id="moretools_assays_tables">
<img src="./moretools_assays_tables.svg" alt="table-level diagram of assay database showing primary and foreign key relationships"/>
<figcaption>Figure&nbsp;8.1: assay database table diagram</figcaption>
</figure>

<figure id="moretools_assays_er">
<img src="./moretools_assays_er.svg" alt="entity-relationship diagram showing logical structure of assay database"/>
<figcaption>Figure&nbsp;8.2: assay ER diagram</figcaption>
</figure>

<div class="language-sql" title="assay_staff.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">staff</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="assay_staff.out">
<div class="highlight"><pre><span></span><code>| ident | personal |  family   | dept | age |
|-------|----------|-----------|------|-----|
| 1     | Kartik   | Gupta     |      | 46  |
| 2     | Divit    | Dhaliwal  | hist | 34  |
| 3     | Indrans  | Sridhar   | mb   | 47  |
| 4     | Pranay   | Khanna    | mb   | 51  |
| 5     | Riaan    | Dua       |      | 23  |
| 6     | Vedika   | Rout      | hist | 45  |
| 7     | Abram    | Chokshi   | gen  | 23  |
| 8     | Romil    | Kapoor    | hist | 38  |
| 9     | Ishaan   | Ramaswamy | mb   | 35  |
| 10    | Nitya    | Lal       | gen  | 52  |
</code></pre></div>
</div>
<h2 class="exercise">Exercise</h2>
<p>Draw a table diagram and an ER diagram to represent the following database:</p>
<ul>
<li><code>person</code> has <code>id</code> and <code>full_name</code></li>
<li><code>course</code> has <code>id</code> and <code>name</code></li>
<li><code>section</code> has <code>course_id</code>, <code>start_date</code>, and <code>end_date</code></li>
<li><code>instructor</code> has <code>person_id</code> and <code>section_id</code></li>
<li><code>student</code> has <code>person_id</code>, <code>section_id</code>, and <code>status</code></li>
</ul>
<h2>Pattern Matching</h2>
<div class="language-sql" title="like_glob.sql">
<div class="highlight"><pre><span></span><code><span class="k">select</span>
<span class="w">    </span><span class="n">personal</span><span class="p">,</span>
<span class="w">    </span><span class="n">family</span>
<span class="k">from</span><span class="w"> </span><span class="n">staff</span>
<span class="k">where</span><span class="w"> </span><span class="n">personal</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="s1">&#39;%ya%&#39;</span><span class="p">;</span>
</code></pre></div>
</div>
<div class="language-out" title="like_glob.out">
<div class="highlight"><pre><span></span><code>| personal | family |
|----------|--------|
| Nitya    | Lal    |
</code></pre></div>
</div>
<ul>
<li><code>like</code> is the original SQL pattern matcher<ul>
<li><code>%</code> matches zero or more characters at the start or end of a string</li>
<li>Case insensitive by default</li>
</ul>
</li>
<li><code>glob</code> supports Unix-style wildcards</li>
</ul>
<h2 class="exercise">Exercise</h2>
<p>Rewrite the pattern-matching query shown above using <code>glob</code>.</p>
    </main>
    <footer>
  © 2024 <a href="https://third-bit.com/">Greg Wilson</a>
  &middot;
  <a href="../">home</a>
  &middot;
  <a href="https://github.com/gvwilson/sql-tutorial">repository</a>
  &middot;
  <a href="../license/">license</a>
</footer>

  </body>
</html>
